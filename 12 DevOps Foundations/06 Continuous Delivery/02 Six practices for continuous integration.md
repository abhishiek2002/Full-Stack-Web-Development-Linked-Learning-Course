Six practices for continuous integration
- We've defined continuous integration, continuous delivery, and continuous deployment. But how do they fit together in practice? Think of them as a pipeline with one stage flowing into the next from build to deploy to release. Each of them depends on the previous step being performed correctly. First, I'll talk about keeping our software in a working state all of the time by using continuous integration in our build stage. In a continuous integration build system, on each commit, there's an automatically triggered build that takes the entire code base, builds it, runs all the unit tests and other code validation steps and packages an artifact at the end of the build, along with a build status and a log. There are many open source and commercial CI systems, but they're all similar at their core. If any step fails, the build is broken and the ability to move past that step is blocked for the entire team. Fixing the build requires a new change that runs through the exact same process. This discipline generates a fast feedback loop for code flaws and it helps reduce rework. Now it sounds simple, but there's a discipline required to make it work effectively. Here are six practices that will help you succeed at continuous integration. The first practice: builds should run quickly. People often ask, does the build pass the coffee test? Well, the build should take less time than it takes to go get a cup of coffee. Now, I'm not a professional barista, but for practical purposes, let's call that five minutes. The longer a build takes, the more people will naturally wait until they have a larger batch of changes to run the build, which increases your work in progress or WIP. High WIP leads to lots of problems in the system, which brings us to the second practice. Commit small changes. Seek to commit the smallest amount of code per commit. Small changes are much easier for everyone on the team to reason about, and it also makes isolating the failure way easier. Oh yeah, failures. That brings us to practice three. Don't leave the build broken. The build is going to break. That's not a problem. It's the system working as designed. But when you leave the build broken, you block delivery. I often suggest that the team make a pact to delay meetings or stop all of their work until the build is fixed. This is a cultural problem and how you handle broken build sets the tone for your delivery culture. Okay, speaking of culture, practice number four, use a trunk based development flow. The state of DevOps report identifies this practice as a hallmark of high performing teams. There are two main practices that people use when developing; branch-based and trunk based. In branch-based development, each developer makes their own copy or branch of the source code, works on it for a long time while they incorporate entire new features and then try to merge back into the main line or trunk. The longer and larger the branch, the more problematic that is. Trunk based means that there are no long running branches and developers make small changes and check them back into trunk multiple times a day. As a result, the trunk is always up to date across all developers. But what about major features that you don't want to release until they're ready? Instead of keeping them in long running code branches, developers can branch in code and use feature flags to define whether those features are user visible or not. Now, having worked in both styles, I highly recommend using a trunk based approach. It helps keep work in progress down to a minimal amount. It ensures that code is reviewed and checked frequently and reduces wasteful and error prone work to merge branches. Okay, practice number five. Don't allow flaky automated tests. Fix them. Have you ever worked somewhere where the tests sometimes failed and sometimes passed for no real apparent reason? Well, I have and it was not a ton of fun. You have no way to know if you can really trust the CI system and if your build artifact was any good. Oh, speaking of artifacts, this brings us to practice six. The build should return a status, a log, and an artifact. The status should be a simple pass fail or red green that tells you whether the build is good to move along in the pipeline. A build log is a detailed record of all the tests run and results of the run, which helps with troubleshooting and compliance. The artifact is an installable version of the application. It should be uploaded and tagged with the build number. This adds trust and assures auditability and immutability of the artifacts. These six practices will help you jumpstart your continuous integration efforts. Take a moment and use the course notebook to reflect and write down the next steps you could take to implement some of these six practices in a build pipeline you work with.